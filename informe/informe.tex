\documentclass[a4paper, 10pt, twoside]{article}

\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[spanish, es-ucroman, es-noquoting]{babel}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{svg}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{float}
\usepackage{svg}
\usepackage{enumitem} % Provee macro \setlist
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{hyperref}
\usepackage{multicol}
\usepackage{verbatim}
\usepackage[procnames]{listings}
\usepackage[toc, page]{appendix}
\usepackage{color}
\usepackage{syntax}


%%%%%%%%%% Configuración de Fancyhdr - Inicio %%%%%%%%%%
\pagestyle{fancy}
\thispagestyle{fancy}
\lhead{Trabajo Práctico · Teoria de Lenguajes}
\rhead{Rodriguez · Pizzagalli}
\renewcommand{\footrulewidth}{0.4pt}
\cfoot{\thepage /\pageref{LastPage}}

\fancypagestyle{caratula} {
   \fancyhf{}
   \cfoot{\thepage /\pageref{LastPage}}
   \renewcommand{\headrulewidth}{0pt}
   \renewcommand{\footrulewidth}{0pt}
}
%%%%%%%%%% Configuración de Fancyhdr - Fin %%%%%%%%%%


%%%%%%%%%% Miscelánea - Inicio %%%%%%%%%%
% Evita que el documento se estire verticalmente para ocupar el espacio vacío
% en cada página.
\raggedbottom

% Deshabilita sangría en la primer línea de un párrafo.
\setlength{\parindent}{0em}

% Separación entre párrafos.
\setlength{\parskip}{0.5em}

% Separación entre elementos de listas.
\setlist{itemsep=0.5em}

% Asigna la traducción de la palabra 'Appendices'.
\renewcommand{\appendixtocname}{Apéndices}
\renewcommand{\appendixpagename}{Apéndices}
%%%%%%%%%% Miscelánea - Fin %%%%%%%%%%


%%%%%%%%%% Insertar diagrama - Inicio %%%%%%%%%%
\newcommand{\diagramav}[1]{%
  \includegraphics[type=pdf,ext=.pdf,read=.pdf,width=16cm]{diagramas/#1}%
}

\newcommand{\diagramavfig}[2]{%
  \begin{figure}[H]
    \includegraphics[type=pdf,ext=.pdf,read=.pdf,width=16cm]{diagramas/#1}%
    \caption{#2}
    \label{fig:#1}
  \end{figure}
}

\newcommand{\diagramavtrim}[2]{%
  \includegraphics[type=pdf,ext=.pdf,read=.pdf,width=16cm,trim=0 #2 0 0,clip]{diagramas/#1}%
}

\newcommand{\diagramah}[1]{%
  \includegraphics[type=pdf,ext=.pdf,read=.pdf,height=16cm,angle=90]{diagramas/#1}%
}
%%%%%%%%%% Insertar diagrama - Fin %%%%%%%%%%


\begin{document}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Carátula                                                                  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\thispagestyle{caratula}

\begin{center}

\includegraphics[height=2cm]{DC.png}
\hfill
\includegraphics[height=2cm]{UBA.jpg}

\vspace{2cm}

Departamento de Computación,\\
Facultad de Ciencias Exactas y Naturales,\\
Universidad de Buenos Aires

\vspace{4cm}

\begin{Huge}
Trabajo Práctico 1
\end{Huge}

\vspace{0.5cm}

\begin{Large}
Teoria de Lenguajes
\end{Large}

\vspace{1cm}

Segundo Cuatrimestre de 2015

\vspace{4cm}

\begin{tabular}{|c|c|c|}
\hline
Apellido y Nombre & LU & E-mail\\
\hline
Rodriguez Pedro & 197/12 & pedro3110.jim@gmail.om \\
Matias Pizzagali & 257/12 & matipizza@gmail.com \\
\hline
\end{tabular}

\end{center}

\newpage

\tableofcontents

\newpage


\section{Introducción}
El objetivo de este trabajo práctico es desarrollar un compositor de fórmulas matemáticas. El mismo tomará como entrada la descripción de una fórmula en una versión muy simplificada del lenguaje utilizado por LATEX y producirá como salida un archivo SVG (Scalable Vector Graphics).

\section{Desarrollo}

\subsection{Desambiguación de la gramática}
Para poder realizar el TP, utilizamos la librería PLY para Python, la cual permite parsear las cadenas
de entrada en función de una gramática que nosotros le proveemos.

La siguiente gramática ambigua fue la propuesta por la cátedra:

\begin{table}[ht]
\begin{tabular} {c c c c c c c}

E & $\rightarrow$ & E & E                 &   & & \\
  & $|$           & E & \detokenize{/}    & E & & \\
  & $|$           & E & \detokenize{^}    & E & & \\
  & $|$           & E & \_                & E & & \\
  & $|$           & E & \detokenize{^}    & E & \_  & E \\
  & $|$           & E & \_                & E & \detokenize{^} & E \\
  & $|$           & \detokenize{(}        & E & \detokenize{)} & & \\
  & $|$           & \{        & E & \} & & \\
  & $|$           & $l$ & & & & \\
\end{tabular}
\end{table}

Como esta gramátia es ambigua, genera conflictos Shift/Reduce y Reduce/Reduce. Es por esto que lo primero que hicimos fue desambiguarla, para obtener la siguiente gramática alternativa,
que genera el mismo lenguaje.

\begin{table}[ht]
\begin{tabular} {c c c c c c c}

S & $\rightarrow$ & E &                   &   & & \\
E & $\rightarrow$ & E & \detokenize{/}    & A & & \\
  & $|$           & A &                   &   & & \\
A & $\rightarrow$ & A &                   & B & & \\
  & $|$           & B &                   &   & & \\
B & $\rightarrow$ & C &                   &   & & \\
  & $|$           & C & \detokenize{^}    & C & & \\
  & $|$           & C & \_                & C & & \\
  & $|$           & C & \detokenize{^}    & C & \_  & C \\
  & $|$           & C & \_                & C & \detokenize{^} & C \\
  & $|$           & \detokenize{(}        & C & \detokenize{)} & & \\
  & $|$           & \{                    & C & \} & & \\
  & $|$           & $ID$                  & & & & \\

\end{tabular}
\end{table}

Tuvimos en cuenta que la división es la operación de menor precedencia, seguida de la concatenación. También que ambas son asociativas a izquierda y que el super y sub índice no son asociativos.

\subsection{TDS y Atributos}
Para cada uno de los símbolos A,B,C,E, definimos los siguientes atributos de tipo enteros: $x$, $y$, $tam (alto)$ (heredados) y $h_up$, $h_down$, $ancho$ (sintetizados). \\


La TDS queda de la siguiente manera:

\begin{itemize}

  \item $ S   \rightarrow \{ E.size = 1, E.x = 0, E.y = 0 \} E \\ $

  \item $ E   \rightarrow \{ A.size = E.size, A.x = E.x, A.y = E.y \} A \\ $

  \item DIVIDE \\ $ E_1 \rightarrow \{ E_{2}.tam = E_{1}.tam, 
                             E_{2}.x = E_{1}.x + ALGO, 
                             E_{2}.y = E_{1}.y + ALGO \} E_2 / \\
                          \{ A.tam = E_{1}.tam, 
                             A.x = E_{1}.x + ALGO, 
                             A.y = E_{1}.y + ALGO \} A \\
                          \{ E_{1}.h\_up = E_{2}.h\_down + E_{2}.h\_up, 
                             E_{1}.h\_down = A.h\_down + A.h\_up, 
                             E_{1}.ancho = max(E_{2}.ancho, A.ancho) \} \\ $

  \item $ A   \rightarrow \{ B.tam = 1, B.x = A.x, B.y = A.y \} B \\
                          \{ A.h\_up = B.h\_up, 
                             A.h\_down = B.h\_down, 
                             A.ancho = B.ancho \} \\ $

  \item CONCAT \\ $ A_1 \rightarrow \{ A_{2}.tam = A_{1}.tam, A_{2}.x = A_{1}.x, A_{2}.y = A_{1}.y \} A_2 \\
                          \{ B.tam = 1, B.x = A_{1}.x + A_{1}.ancho + A_{2}.ancho, B.y = A_{1}.y \} B \\
                          \{ A_{1}.h\_up = max(C_{1}.h\_up, C_{1}.h\_down), 
                             A_{1}.h\_down = max(C_{1}.h\_up, C_{1}.h\_down), 
                             A_{1}.ancho = A_{2}.ancho + B.ancho \} \\ $

  \item $ B \rightarrow \{ C.tam = B.tam, C.x = B.x, C.y = B.y \} C \\
                        \{ B.ancho = C.ancho, B.h\_up = C.h\_up, B.h\_down = C.h\_down \} \\ $

  \item SUPERINDEX \\
        $ B \rightarrow \{ C_{1}.tam = B.tam, C_{1}.x = B.x, C_{1}.y = B.y - ((B.h\_up + B.h\_down) * 0.5) \}
                        C_1 \detokenize{^} \\
                        \{ C_{2}.tam = C_{1}.tam * 0.7, C_{2}.x = C_{1}.x + C_{1}.ancho, C_{2}.y = C_{1}.y \} 
                        C_2 \\
                        \{ B.ancho = C_{1}.ancho + C_{2}.ancho, B.h\_up = C_{1}.h\_up + C_{2}.h\_up * 0.5, 
                           B.h\_down = 0 \} \\ $

  \item SUBINDEX \\ 
        $ B \rightarrow \{ C_{1}.tam = B.tam, C_{1}.x = B.x, C_{1}.y = B.y - ((B.h\_up + B.h\_down) * 0.5) \}
                        C_1 \_ \\
                        \{ C_{2}.tam = C_{1}.tam * 0.7, C_{2}.x = C_{1}.x + C_{1}.ancho, C_{2}.y = C_{1}.y \} 
                        C_2 \\
                        \{ B.ancho = C_{1}.ancho + C_{2}.ancho, B.h\_up = C_{1}.h\_up + C_{2}.h\_up * 0.5, 
                           B.h\_down = 0 \} \\ $

  \item SUPERSUBINDEX \\
        $ B \rightarrow \{ C_{1}.tam = B.tam, C_{1}.x = B.x, C_{1}.y = B.y - ((B.h\_up + B.h\_down) * 0.5) \}
                        C_1 \detokenize{^} \\
                        \{ C_{2}.tam = C_{1}.tam * 0.7, C_{2}.x = C_{1}.x + C_{1}.ancho, C_{2}.y = C_{1}.y \}
                        C_2 \_ \\
                        \{ C_{3}.tam = C_{1}.tam * 0.7, C_{3}.x = C_{1}.x + C_{1}.ancho, C_{3}.y = C_{1}.y \}
                        C_3 \\
                        \{ B.ancho = C_{1}.ancho + C_{2}.ancho + C_{2}.ancho, 
                           B.h\_up = C_{1}.h\_up + C_{2}.h\_up * 0.5, 
                           B.h\_down = ? \} \\ $

  \item SUBSUPERINDEX \\
        $ B \rightarrow \{ C_{1}.tam = B.tam, C_{1}.x = B.x, C_{1}.y = B.y - ((B.h\_up + B.h\_down) * 0.5) \} 
                        C_1 \_ \\
                        \{ C_{2}.tam = C_{1}.tam * 0.7, C_{2}.x = C_{1}.x + C_{1}.ancho, C_{2}.y = C_{1}.y \} 
                        C_2 \detokenize{^} \\
                        \{ C_{3}.tam = C_{1}.tam * 0.7, C_{3}.x = C_{1}.x + C_{1}.ancho, C_{3}.y = C_{1}.y \} 
                        C_3 \\
                        \{ B.ancho = C_{1}.ancho + C_{2}.ancho + C_{2}.ancho, 
                           B.h\_up = C_{1}.h\_up + C_{2}.h\_up * 0.5, 
                           B.h\_down = ? \} $

  \item $ B \rightarrow ( \{ E.x = B.x, E.y = B.y, E.tam = B.tam \} E \\
                          \{ B.h\_up = E.h\_up, B.h\_down = E.h\_down, B.ancho = E.ancho \} ) \\ $

  \item $ B \rightarrow \{ \{ E.x = B.x, E.y = B.y, E.tam = B.tam \} E \\
                          \{ B.h\_up = E.h\_up, B.h\_down = E.h\_down, B.ancho = E.ancho \} \} \\ $

  \item $ B \rightarrow ID \{ B.h\_up = 0.6 * B.tam, B.h\_down = 0, B.ancho = 0.6 * B.tam \} \\ $  

\end{itemize}

\section{Resultados}
\begin{figure}[h]

\end{figure}

\section{Codigo}
\definecolor{keywords}{RGB}{255,0,90}
\definecolor{comments}{RGB}{0,0,113}
\definecolor{red}{RGB}{160,0,0}
\definecolor{green}{RGB}{0,150,0}

\lstset{language=Python,
        breaklines=true,
        basicstyle=\ttfamily\small,
        keywordstyle=\color{keywords},
        commentstyle=\color{comments},
        stringstyle=\color{red},
        showstringspaces=false,
        identifierstyle=\color{green},
        procnamekeys={def,class}}

\subsection{tp.py}
\lstinputlisting{../tp.py}

\subsection{lexer_rules.py}
\lstinputlisting{../lexerrules.py}

\subsection{parser_rules.py}
\lstinputlisting{../parserrules.py}


\end{document}
